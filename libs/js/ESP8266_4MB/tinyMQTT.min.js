function h(a){3===a.charCodeAt(0)>>4&&(len=a.charCodeAt(2)<<8|a.charCodeAt(3),ofs=4,127<a.charCodeAt(1)&&(len=a.charCodeAt(4),ofs=5),pub={topic:a.substr(ofs,len),message:a.substr(ofs+len,a.charCodeAt(1)-len)},_q.emit("publish",pub))}function e(a){return d(a.length>>8,a.length&255)+a}function g(a,b,c){return d(a,b.length+c.length)+b+c}function k(a){var b=0;a=e(a);_q.usr&&_q.pwd&&(b|=_q.usr?128:0,b|=_q.usr&&_q.pwd?64:0,a+=e(_q.usr)+e(_q.pwd));b=d(parseInt(b.toString(16),16));return g(16,
e("MQTT")+"\u0004"+b+"\u00ff\u00ff",a)}var f=function(a,b){var c=b||{};this.svr=a;this.prt=c.port||1883;this.ka=c.keep_alive||60;this.usr=c.username;this.pwd=c.password;this.cn=!1;this.ri=c.reconnect_interval||2E3;_q=this},d=String.fromCharCode;f.prototype.connect=function(){var a=function(){clearInterval(b);_q.cl.write(k(getSerial()));_q.emit("connected");_q.cn=!0;setInterval(function(){_q.cn&&_q.cl.write(d(192)+"\x00")},_q.ka<<10);_q.cl.on("data",h.bind(_q));_q.cl.on("end",function(){_q.cn&&_q.emit("disconnected");
_q.cn=!1;delete _q.cl});_q.removeAllListeners("connected")};if(!_q.cn)var b=setInterval(function(){_q.cl&&(_q.cl.end(),delete _q.cl);_q.cl=require("net").connect({host:_q.svr,port:_q.prt},a)},_q.ri)};f.prototype.subscribe=function(a){_q.cl.write(g(130,d(256,1),e(a)+d(1)))};f.prototype.publish=function(a,b){_q.cn&&_q.cl.write(g(49,e(a),b))};f.prototype.disconnect=function(){_q.cl.write(d(224)+"\x00")};exports.create=function(a,b){return new f(a,b)}